{"searchDocs":[{"title":"ğŸ¦¸ ä¿å­˜åˆ°é›†åˆ","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/exporting-data/saving-to-collection","content":"ğŸ¦¸ ä¿å­˜åˆ°é›†åˆ ä½ å¯ä»¥å°†èšåˆç®¡é“çš„ç»“æœå¯¼å‡ºåˆ°ä¸åŒçš„æ•°æ®åº“/é›†åˆã€‚ä¸ºæ­¤ï¼Œåªéœ€åœ¨ç®¡é“çš„æœ€åæ·»åŠ ä¸€ä¸ªèšåˆé˜¶æ®µï¼š { $out: { db: &quot;&lt;output-db&gt;&quot;, coll: &quot;&lt;output-collection&gt;&quot; } } ä½ å¯ä»¥çœç•¥dbå±æ€§ï¼Œè¿™ç§æƒ…å†µä¸‹æ–°é›†åˆå°†åˆ›å»ºåœ¨å½“å‰æ•°æ®åº“ä¸­ã€‚ { $out: &quot;&lt;output-collection&gt;&quot; } ğŸ‘ åˆ›å»ºä¸€æœ¬æ­£å¥½æœ‰100é¡µçš„ä¹¦çš„å‰¯æœ¬ï¼Œå¹¶è¾“å‡ºä¸ºä¸€ä¸ªåä¸ºOneHundredPagesBooksçš„æ–°é›†åˆã€‚ ç­”æ¡ˆ let oneHundredPagesBooks = {$match: {pages: 100}}; let saveToNewCollection = {$out: &quot;OneHundredPagesBooks&quot;} db.books.aggregate([ oneHundredPagesBooks, saveToNewCollection ]); è¿è¡Œæ­¤ä»£ç åï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°ä¸€ä¸ªæ–°é›†åˆï¼š show collections ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ $count","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/counting-sorting/counting-documents","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"é˜¶æ®µçš„é¡ºåºå¾ˆé‡è¦â€‹","type":1,"pageTitle":"ğŸ‘ $count","url":"/aggregation-pipeline-lab/zh/docs/counting-sorting/counting-documents#é˜¶æ®µçš„é¡ºåºå¾ˆé‡è¦","content":" å¦‚æœæˆ‘ä»¬åœ¨$matché˜¶æ®µä¹‹åè¿›è¡Œè®¡æ•°ï¼Œæˆ‘ä»¬ä¼ é€’ç»™ä¸‹ä¸€æ­¥éª¤çš„æ–‡æ¡£åªåŒ…å«totalBookså­—æ®µã€‚å› æ­¤ï¼Œ$projecté˜¶æ®µå°†è¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£ã€‚  let moreThan150pages = {pages: {$gte: 150}} let booksFrom1985WithMoreThan150pages = {$match: {$and: [{year: 1985}, moreThan150pages]}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1}}; let getJust15books = {$limit: 15}; let count = {$count: &quot;totalBooks&quot;} db.books.aggregate([ booksFrom1985WithMoreThan150pages, count, showOnlyTheseFields, getJust15books, ]);  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ä»‹ç»","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/intro","content":"ä»‹ç» å®éªŒç›®æ ‡\täº†è§£èšåˆç®¡é“ï¼Œç¼–å†™èšåˆç®¡é“ä½ å°†å­¦åˆ°\tä»€ä¹ˆæ˜¯èšåˆç®¡é“ å®ƒä»¬ä¸ç®€å•çš„ MongoDB æŸ¥è¯¢æˆ– SQL æœ‰ä»€ä¹ˆä¸åŒ å¦‚ä½•ä½¿ç”¨ç®€å•çš„èšåˆç®¡é“è·å–æ•°æ®ã€è¿‡æ»¤æ•°æ®ã€æ˜¾ç¤ºæ‰€éœ€çš„å­—æ®µ å¦‚ä½•ç¼–å†™æ›´é«˜çº§çš„ç®¡é“ï¼ŒæŸ¥è¯¢æ•°ç»„ã€è®¡æ•°å’Œæ’åºç»“æœ å¦‚ä½•ä½¿ç”¨ $lookup è¿›è¡Œè·¨é›†åˆ JOIN å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ å¦‚ä½•å¯¼å‡ºæ•°æ® å¦‚ä½•ä½¿ç”¨æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ç¼–å†™èšåˆï¼ˆå¾…å®šï¼‰ å®Œæˆæ—¶é—´\t90 åˆ†é’Ÿ åœ¨å¯¼èˆªæ å’ŒæŸäº›é¡µé¢ä¸­ï¼Œä½ ä¼šæ³¨æ„åˆ°ä¸€äº›å›¾æ ‡ã€‚å®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š å›¾æ ‡\tå«ä¹‰ğŸ“˜\tè®²ä¹‰ææ–™ - å¦‚æœæ‚¨æ­£åœ¨è·Ÿéšå¯¼å¸ˆä¸»å¯¼çš„è¯¾ç¨‹ï¼Œä»–ä»¬å¯èƒ½å·²ç»è¦†ç›–äº†è¿™äº›ææ–™ã€‚ ğŸ‘\tåŠ¨æ‰‹å†…å®¹ - å‡†å¤‡å¥½è¿›è¡Œä¸€äº›å®é™…æ“ä½œã€‚æ‚¨åº”è¯¥æŒ‰ç…§è¿™äº›æ­¥éª¤è¿›è¡Œã€‚ ğŸ’¬\tè¯é¢˜è®¨è®º - åœ¨å®éªŒæœŸé—´å‚ä¸è®¨è®ºçš„é¡¹ç›®ã€‚ ğŸ¦¸\té«˜çº§å†…å®¹ - è¿™äº›å†…å®¹åœ¨å®éªŒæœŸé—´æœªè¦†ç›–ï¼Œä½†å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æ›´å¤šï¼Œå¯ä»¥æŸ¥çœ‹ã€‚","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ“˜ è®²åº§ææ–™","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/lecture-material","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"èšåˆç®¡é“å¤‡å¿˜å•â€‹","type":1,"pageTitle":"ğŸ“˜ è®²åº§ææ–™","url":"/aggregation-pipeline-lab/zh/docs/lecture-material#èšåˆç®¡é“å¤‡å¿˜å•","content":"   æ— æ³•æ˜¾ç¤º PDF æ–‡ä»¶ã€‚è¯·ç‚¹å‡» ä¸‹è½½ã€‚ ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ‘ $group","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/grouping/group","content":"ğŸ‘ $group æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¯å¹´æ‰€æœ‰ä¹¦ç±çš„æ€»é¡µæ•°ï¼š db.books.aggregate([ {$group:{ _id: &quot;$year&quot;, totalPages: {$sum: &quot;$pages&quot;} }} ]) åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‰ä¹¦ç±çš„yearè¿›è¡Œåˆ†ç»„ï¼ˆåˆ†ç»„å¹¶ä½œä¸ºæ–°çš„_idï¼‰ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåä¸ºtotalPagesçš„æ–°å­—æ®µï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ‰€æœ‰é¡µæ•°çš„æ€»å’Œã€‚ ğŸ‘ ä½ èƒ½è·å–æŒ‰å¹´ä»½å‡åºæ’åºçš„ç»“æœå—ï¼Ÿ ç­”æ¡ˆ db.books.aggregate([ {$group:{ _id: &quot;$year&quot;, totalPages: {$sum: &quot;$pages&quot;} }}, {$sort: {_id: 1}} ]) ğŸ‘ ä½ èƒ½è·å–æ¯å¹´çš„å¹³å‡é¡µæ•°å—ï¼ˆæç¤ºï¼šä½¿ç”¨$avgï¼‰ï¼Ÿ ç­”æ¡ˆ db.books.aggregate([ {$group:{ _id: &quot;$year&quot;, totalPages: {$avg: &quot;$pages&quot;} }}, {$sort: {_id: 1}} ]) ğŸ‘ å“ªä¸€å¹´å°åˆ·äº†æœ€å¤šçš„é¡µæ•°ï¼Ÿ ç­”æ¡ˆ db.books.aggregate([ {$group:{ _id: &quot;$year&quot;, totalPages: {$sum: &quot;$pages&quot;} }}, {$sort: {totalPages: -1}}, {$limit: 1} ]) ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ å‘ç»“æœæ·»åŠ æ–°å­—æ®µ","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/modifying-results/adding-fields","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"$addFieldsâ€‹","type":1,"pageTitle":"ğŸ‘ å‘ç»“æœæ·»åŠ æ–°å­—æ®µ","url":"/aggregation-pipeline-lab/zh/docs/modifying-results/adding-fields#addfields","content":" æˆ‘ä»¬æƒ³ä¼°è®¡ä¸€æœ¬ä¹¦çš„é˜…è¯»æ—¶é—´ã€‚ä½†æˆ‘ä»¬æ²¡æœ‰å°†è¯¥å­—æ®µå­˜å‚¨åœ¨æ•°æ®ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨$addFieldsæ¥å®ç°ã€‚å¦‚æœè¯¥å­—æ®µå­˜åœ¨ï¼Œå®ƒå°†è¢«æ›´æ–°ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ ã€‚  db.books.aggregate([ {$project: { title: 1, pages: 1, } }, {$addFields: {readingTimeHours: {$divide: [{$multiply: [&quot;$pages&quot;, 2]}, 60]}}}, ])   ğŸ‘ ä¸ºæ‰€æœ‰æ–‡æ¡£æ·»åŠ ä¸€ä¸ªåŒ…å«æ–‡æœ¬PLACEHOLDERçš„æ–°å­—æ®µnotesã€‚  ç­”æ¡ˆ db.books.aggregate([ {$project: { title: 1, pages: 1, } }, {$addFields: {notes: &quot;PLACEHOLDER&quot;}} ])  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ‘ Lookup åˆå Left Outer Joinï¼ˆå¤–è¿æ¥ï¼‰","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/lookups/lookups","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ä»ä¹‹å‰çš„é˜¶æ®µè¿›è¡ŒæŸ¥æ‰¾â€‹","type":1,"pageTitle":"ğŸ‘ Lookup åˆå Left Outer Joinï¼ˆå¤–è¿æ¥ï¼‰","url":"/aggregation-pipeline-lab/zh/docs/lookups/lookups#ä»ä¹‹å‰çš„é˜¶æ®µè¿›è¡ŒæŸ¥æ‰¾","content":" æˆ‘ä»¬å¯ä»¥å¯¹å¦ä¸€ä¸ªç®¡é“çš„ç»“æœè¿›è¡Œ$lookupï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸ä¸€ä¸ªé›†åˆè¿æ¥ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³åœ¨è¿æ¥ä¹‹å‰ä»ä¹¦ç±ä¸­åˆ é™¤ä¸€äº›å™ªéŸ³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨$projectæ’é™¤å‡ ä¸ªæ•°ç»„ã€‚  db.authors.aggregate([ {$lookup: { from: &quot;books&quot;, localField: &quot;books&quot;, foreignField: &quot;_id&quot;, pipeline: [ {$project: {title: 1, synopsis: 1}} ], as: &quot;booksWritten&quot; } } ])   æ›´å¥½çš„åšæ³•æ˜¯æˆ‘ä»¬å¯ä»¥æå–è¯¥ç®¡é“å¹¶è¿›è¡Œæµ‹è¯•/è°ƒæ•´ã€‚  let justShowTitleSynopsis = [ {$project: {title: 1, synopsis: 1}}, ] db.authors.aggregate([ {$lookup: { from: &quot;books&quot;, localField: &quot;books&quot;, foreignField: &quot;_id&quot;, pipeline: justShowTitleSynopsis, as: &quot;booksWritten&quot; } } ])  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ¦¸â€â™‚ï¸ é«˜çº§ lookup","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/lookups/advanced-lookups","content":"ğŸ¦¸â€â™‚ï¸ é«˜çº§ lookup ä¿¡æ¯ é¢å¤–æ´»åŠ¨ï¼šå¦‚æœæ‚¨æœ‰é¢å¤–çš„æ—¶é—´æˆ–åœ¨å®¶è·Ÿç€åšï¼Œå¯ä»¥å°è¯•ï¼Œå¯¼å¸ˆä¸ä¼šåœ¨åŠ¨æ‰‹å®éªŒä¸­è¿›è¡Œè®²è§£ æˆ‘ä»¬æ”¶åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå†™ä¸€ä¸ª$lookupï¼Œä»¥è·å–æ¯ä¸ªä¹¦ç±æ–‡æ¡£ä¸­ä½œè€…çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬nameå’Œbioã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å›é¡¾å‡ ä»¶äº‹æƒ…ï¼š æ¯æœ¬ä¹¦å¯ä»¥æœ‰å¤šä¸ªä½œè€…ã€‚è¿™ç§å¤šå¯¹å¤šçš„å…³ç³»ï¼ˆå› ä¸ºä¸€ä¸ªä½œè€…ä¹Ÿå¯ä»¥å†™å¤šæœ¬ä¹¦ï¼‰æ˜¯é€šè¿‡ä¸¤ä¸ªä¸åŒçš„æ•°ç»„æ¥å»ºæ¨¡çš„ï¼šauthorsé›†åˆä¸­çš„ä¸€ä¸ªbooksæ•°ç»„å’Œbooksé›†åˆä¸­çš„ä¸€ä¸ªauthorsæ•°ç»„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºæ¯æœ¬æœ‰å¤šä¸ªä½œè€…çš„ä¹¦ç±è·å–ä¸€ä¸ªå•ç‹¬çš„æ–‡æ¡£ã€‚å¦‚æœä¸€æœ¬ä¹¦æœ‰ä¸‰ä¸ªä½œè€…ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨$unwindæ¥è·å–ä¸‰ä¸ªæ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£çš„æ•°æ®ç›¸åŒï¼Œé™¤äº†ä½œè€…å­—æ®µçš„å†…å®¹ä¸åŒã€‚ ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªèšåˆç®¡é“æ¥å°è¯•ï¼š db.books.aggregate([ // å› ä¸ºä¸€æœ¬ä¹¦å¯ä»¥æœ‰å¤šä¸ªä½œè€…ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä¹¦ç±çš„ä½œè€…è·å–ä¸€ä¸ªæ–‡æ¡£ {$unwind: &quot;$authors&quot;}, // åˆ é™¤ä¸€äº›å¹²æ‰°å­—æ®µ {$project: {attributes: 0, reviews: 0}} ]) ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦è·å–ä½œè€…çš„ä¿¡æ¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨$lookupï¼Œå°†authorsé›†åˆä¸­çš„_idä¸æˆ‘ä»¬åœ¨æ¯æœ¬ä¹¦çš„authorsæ•°ç»„ä¸­çš„_idè¿›è¡Œé“¾æ¥ã€‚ä½†æ­£å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„ï¼Œè¿™äº›ç±»å‹ä¸åŒï¼šæˆ‘ä»¬æ•°ç»„ä¸­çš„é‚£äº›æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œauthorsé›†åˆä¸­çš„_idæ˜¯ObjectIdã€‚ authors: { _id: '64cc2db4830ba29148da64a2', name: 'Timothy Findley' }, æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†Stringè½¬æ¢ä¸ºObjectIdã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨$toObjectIdæ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™å°†æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µauthorIdï¼Œå°†å…¶è½¬æ¢ä¸ºObjectIdï¼š db.books.aggregate([ // å› ä¸ºä¸€æœ¬ä¹¦å¯ä»¥æœ‰å¤šä¸ªä½œè€…ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä¹¦ç±çš„ä½œè€…è·å–ä¸€ä¸ªæ–‡æ¡£ {$unwind: &quot;$authors&quot;}, // å°†å…¶è½¬æ¢ä¸ºObjectId {&quot;$set&quot;:{&quot;authorId&quot;:{&quot;$toObjectId&quot;:&quot;$authors._id&quot;}}}, // åˆ é™¤ä¸€äº›å¹²æ‰°å­—æ®µ {$project: {attributes: 0, reviews: 0}} ]) ç°åœ¨æˆ‘ä»¬å‡†å¤‡è¿›è¡Œ$lookupï¼šæˆ‘ä»¬å¸Œæœ›è·å–æ‰€æœ‰authorsä¸­_idä¸æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„authorIdç›¸åŒçš„æ–‡æ¡£ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªpipelineæ¥ä»…è·å–authorsçš„nameå’Œbioã€‚ db.books.aggregate([ // å› ä¸ºä¸€æœ¬ä¹¦å¯ä»¥æœ‰å¤šä¸ªä½œè€…ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªä¹¦ç±çš„ä½œè€…è·å–ä¸€ä¸ªæ–‡æ¡£ {$unwind: &quot;$authors&quot;}, // å°†å…¶è½¬æ¢ä¸ºObjectId {&quot;$set&quot;:{&quot;authorId&quot;:{&quot;$toObjectId&quot;:&quot;$authors._id&quot;}}}, {$lookup: { from: &quot;authors&quot;, localField: &quot;authorId&quot;, foreignField: &quot;_id&quot;, pipeline: [ {$project: {name: 1, bio: 1}}, ], as: &quot;bookAuthorDetails&quot; } }, // åˆ é™¤ä¸€äº›å¹²æ‰°å­—æ®µ {$project: {attributes: 0, reviews: 0}} ]) ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ è®¾ç½®å®éªŒ","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/mongodb-atlas/setup-lab","content":"ğŸ‘ è®¾ç½®å®éªŒ è¦è·Ÿä¸Šè¿›åº¦ï¼Œæ‚¨éœ€è¦ï¼š ä¸€ä¸ª MongoDB Atlas è´¦æˆ·ä¸€ä¸ª MongoDB é›†ç¾¤æµ‹è¯•æ•°æ®ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™æ˜¯ç”¨äºå›¾ä¹¦é¦†ç®¡ç†ç³»ç»Ÿçš„ä¹¦ç±ã€ä½œè€…å’Œè¯„è®ºæ•°æ®ã€‚ ğŸ‘ è¦è·å–è¿™ä¸¤è€…ï¼Œè¯·æ‰“å¼€ å…¥é—¨å®éªŒ å¹¶æŒ‰ç…§æ­¥éª¤æ“ä½œï¼ˆåªéœ€ 10-15 åˆ†é’Ÿï¼‰ä»¥å‡†å¤‡å¥½æ‚¨çš„æ•°æ®åº“ã€‚å®Œæˆåè¿”å›è¿™é‡Œï¼","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ¦¸ ç¼ºå¤±æ•°æ®","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/modifying-results/missing-data","content":"ğŸ¦¸ ç¼ºå¤±æ•°æ® æœ‰æ—¶æˆ‘ä»¬ä¼šç¼ºå°‘æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„å­—æ®µï¼ˆå®ƒä¸å­˜åœ¨ï¼Œå› ä¸ºé›†åˆä¸­çš„æ–‡æ¡£å¯ä»¥æ˜¯å¤šæ€çš„ï¼Œæ‰€ä»¥è¯¥å­—æ®µä¸ºnullï¼‰ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨$ifNullæ£€æŸ¥æŸäº›å†…å®¹æ˜¯å¦å­˜åœ¨ï¼Œå¹¶åœ¨è¿™ç§æƒ…å†µä¸‹æ·»åŠ ä¸€ä¸ªé»˜è®¤å€¼ã€‚ let getAuthorsWithBooks = { $project: { name: 1, books: { $ifNull: [&quot;$books&quot;, []]}, } } db.authors.aggregate([ getAuthorsWithBooks, ]) ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ¦¸â€â™‚ï¸ èšåˆé€‰é¡¹","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/aggregation-options","content":"ğŸ¦¸â€â™‚ï¸ èšåˆé€‰é¡¹ ä¿¡æ¯ é¢å¤–æ´»åŠ¨ï¼šå¦‚æœæ‚¨æœ‰é¢å¤–çš„æ—¶é—´æˆ–åœ¨å®¶è·Ÿç€åšï¼Œå¯ä»¥å°è¯•ï¼Œå¯¼å¸ˆä¸ä¼šåœ¨åŠ¨æ‰‹å®éªŒä¸­è¿›è¡Œè®²è§£ å±é™© ä»¥ä¸‹è¯­æ³•åœ¨ Atlas UI èšåˆç¼–è¾‘å™¨ä¸­ä¸èµ·ä½œç”¨ã€‚ æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ªå¸¦æœ‰ä¸€äº›é€‰é¡¹çš„æ–‡æ¡£ç»™ aggregateã€‚ let options = { maxTimeMS: 100 }; db.authors.aggregate([], options); ğŸ’» ä½ å¯ä»¥ä¼ é€’ç»™ aggregate æ–¹æ³•ä¸åŒé€‰é¡¹ï¼ŒæŸ¥çœ‹ æ–‡æ¡£ã€‚ ğŸ’» å°è¯•ä½¿ç”¨ 10 æ¯«ç§’çš„æ—¶é—´é™åˆ¶å¯åŠ¨ä¸€ä¸ª itcountï¼ˆä¸€ä¸ªé•¿æ“ä½œï¼‰æ¥éå†æ•´ä¸ª books æ¸¸æ ‡ï¼šä½ åº”è¯¥çœ‹åˆ°æ“ä½œè¶…æ—¶å¹¶å¤±è´¥ã€‚ let options = { maxTimeMS: 10 }; db.authors.aggregate([], options).itcount(); &gt; MongoServerError: operation exceeded time limit ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ ç»„åˆé˜¶æ®µ","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/combining-them-all","content":"ğŸ‘ ç»„åˆé˜¶æ®µ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªåœ¨ç®¡é“ä¸­ä½¿ç”¨äº†ä¸€ä¸ªé˜¶æ®µã€‚ä½†èšåˆç®¡é“çš„å¼ºå¤§ä¹‹å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªé˜¶æ®µï¼Œä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºå°†æˆä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ UNIX ç®¡é“æˆ–ä½¿ç”¨å¸¦æœ‰ mapã€filterã€reduceã€flatmap ç­‰çš„å‡½æ•°å¼ç¼–ç¨‹ã€‚ è·å– 2001 å¹´ 200 é¡µçš„ 10 æœ¬ä¹¦ã€‚åªæ˜¾ç¤ºæ ‡é¢˜å’Œä½œè€…ã€‚ Atlas UIMongoDB Shell [ { $match: { year: 2001, pages: 200 } }, { $project: { _id: 0, title: 1, authors: 1 } }, { $limit: 10 }, ] ğŸ‘ è·å– 1985 å¹´ 150 é¡µçš„ 15 æœ¬ä¹¦ã€‚åªæ˜¾ç¤º titleã€yearã€totalInventory å’Œ available å­—æ®µã€‚å¦‚æœä½ ä¸è®°å¾—æœ‰å“ªäº›å­—æ®µï¼Œå¯ä»¥å‚è€ƒç¤ºä¾‹æ–‡æ¡£ã€‚ ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $match: { year: 1985, pages: 150 } }, { $project: { _id: 0, title: 1, year: 1, totalInventory: 1, available: 1 } }, { $limit: 15 }, ] ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ æ’åº","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/counting-sorting/sorting","content":"ğŸ‘ æ’åº æˆ‘ä»¬å¯ä»¥ä½¿ç”¨$sorté˜¶æ®µå¯¹ç»“æœè¿›è¡Œæ’åºã€‚æˆ‘ä»¬éœ€è¦å¯¹å­—æ®µè¿›è¡Œæ’åºï¼Œ1è¡¨ç¤ºå‡åºï¼Œ-1è¡¨ç¤ºé™åºã€‚ ğŸ‘ è®©æˆ‘ä»¬è·å–æ‰€æœ‰1984å¹´çš„ä¹¦ç±ï¼Œå¹¶æŒ‰é¡µæ•°æ’åºã€‚æˆ‘ä»¬åªæ˜¾ç¤ºæ ‡é¢˜ã€é¡µæ•°å’Œä½œè€…ã€‚ let booksFrom1984 = {$match: {year: 1984}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, pages: 1, authors: 1}}; let slimmerBooksFirst = {$sort: {&quot;pages&quot;: 1}} db.books.aggregate([ booksFrom1984, showOnlyTheseFields, slimmerBooksFirst, ]); å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæ²¡æœ‰pagesä¿¡æ¯çš„ä¹¦ç±é¦–å…ˆå‡ºç°ã€‚è¿™äº›æ–‡æ¡£æ²¡æœ‰è¯¥ä¿¡æ¯ï¼Œå› æ­¤pagesä¸ºnullï¼Œå¹¶è¢«æ’åºä¸ºå°äºä»»ä½•æ•°å­—ã€‚ ğŸ‘ æˆ‘ä»¬å¯ä»¥åè¿‡æ¥æ’åºï¼š let booksFrom1984 = {$match: {year: 1984}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, pages: 1, authors: 1}}; let thickerBooksFirst = {$sort: {&quot;pages&quot;: -1}} db.books.aggregate([ booksFrom1984, showOnlyTheseFields, thickerBooksFirst, ]); ğŸ‘ æˆ‘ä»¬å¦‚ä½•è·å–1984å¹´æœ€åšçš„ä¹¦ï¼Ÿ ç­”æ¡ˆ let booksFrom1984 = {$match: {year: 1984}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, pages: 1, authors: 1}}; let thickerBooksFirst = {$sort: {&quot;pages&quot;: -1}} let justOne = {$limit: 1} db.books.aggregate([ booksFrom1984, showOnlyTheseFields, thickerBooksFirst, justOne ]); ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ ç©ºèšåˆç®¡é“","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/empty-aggregation","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ä¸€ä¸ªç©ºçš„èšåˆâ€‹","type":1,"pageTitle":"ğŸ‘ ç©ºèšåˆç®¡é“","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/empty-aggregation#ä¸€ä¸ªç©ºçš„èšåˆ","content":" è¿™æ®µä»£ç ç›¸å½“äº SELECT * FROM AUTHORSã€‚è¿”å›ä¸€ä¸ªåŒ…å« authors é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£çš„ æ¸¸æ ‡ï¼ˆcursorï¼‰ï¼š  Atlas UIMongoDB Shell æ‰“å¼€ Aggregation é€‰é¡¹å¡ã€‚é€‰æ‹© Textã€‚è¾“å…¥å¦‚ä¸‹ä¸€ä¸ªç©ºæ•°ç»„ï¼Œæ³¨æ„ç¼–è¾‘å™¨ä¸­çš„ç©ºæ•°ç»„è¡¨ç¤ºä¸€ä¸ªç©ºçš„èšåˆç®¡é“ï¼š []  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ‘ $limit","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/limiting-results","content":"ğŸ‘ $limit å¦‚æœæˆ‘ä»¬è¿”å›äº†å¤ªå¤šçš„æ–‡æ¡£ï¼Œä½†æˆ‘ä»¬åªå¯¹å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ $limit æ¥é™åˆ¶è¿”å›çš„æ–‡æ¡£æ•°é‡ã€‚ Atlas UIMongoDB Shell [ { $limit: 1 } ] è¿™åªè¿”å›ä¸€ä¸ªæ–‡æ¡£ã€‚ ğŸ‘ åªè¿”å› 7 æœ¬ booksã€‚ ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $limit: 7 } ] ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ¦¸â€â™‚ï¸ é‡å¤é˜¶æ®µ","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/repeating-stages","content":"ğŸ¦¸â€â™‚ï¸ é‡å¤é˜¶æ®µ ä¿¡æ¯ é¢å¤–æ´»åŠ¨ï¼šå¦‚æœæ‚¨æœ‰é¢å¤–çš„æ—¶é—´æˆ–åœ¨å®¶è·Ÿç€åšï¼Œå¯ä»¥å°è¯•ï¼Œå¯¼å¸ˆä¸ä¼šåœ¨åŠ¨æ‰‹å®éªŒä¸­è¿›è¡Œè®²è§£ ä» Aggregation Pipelines æ‰‹å†Œ ä¸­å¼•ç”¨ï¼š é™¤äº† $out, $merge, $geoNear, $changeStream å’Œ $changeStreamSplitLargeEvent é˜¶æ®µå¤–ï¼Œå…¶ä»–æ‰€æœ‰é˜¶æ®µéƒ½å¯ä»¥åœ¨ä¸€ä¸ªç®¡é“ä¸­å¤šæ¬¡å‡ºç°ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥é‡å¤å¤§å¤šæ•°é˜¶æ®µï¼Œå¹¶åšç±»ä¼¼äºä»¥ä¸‹æ“ä½œï¼Œä»¥è·å–1985å¹´ä¸”é¡µæ•°è¶…è¿‡100é¡µçš„æ‰€æœ‰ä¹¦ç±ï¼ˆå°½ç®¡è¿™å¯èƒ½æœ‰æ„ä¹‰æˆ–æ²¡æœ‰æ„ä¹‰ï¼‰ Atlas UIMongoDB Shell [ { $match: { pages: {$gte: 100} } }, { $match: { year: 1985 } } ] ğŸ’» åœ¨ä¸Šè¿°èšåˆçš„æœ«å°¾æ·»åŠ å‡ ä¸ª $limit é˜¶æ®µï¼Œé™åˆ¶ä¸º1æœ¬ä¹¦ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ ç­”æ¡ˆ Atlas UIMongoDB Shell [ {$match: {pages: {$gte: 100}}}, {$match: {year: 2011}}, {$limit: 1}, {$limit: 1}, ] ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ ä½¿ç”¨å›¾ä¹¦é¦†æ•°æ®åº“","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/using-library-database","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"é€‰æ‹©å›¾ä¹¦é¦†æ•°æ®åº“â€‹","type":1,"pageTitle":"ğŸ‘ ä½¿ç”¨å›¾ä¹¦é¦†æ•°æ®åº“","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/using-library-database#é€‰æ‹©å›¾ä¹¦é¦†æ•°æ®åº“","content":" ğŸ’» æˆ‘ä»¬å°†åœ¨æ­¤å®éªŒä¸­ä½¿ç”¨ library æ•°æ®åº“è¿›è¡Œæ‰€æœ‰å®è·µç»ƒä¹ ã€‚ å¦‚æœæ‚¨è¿˜æ²¡æœ‰æ‰§è¡Œå‰ç½®æ•°æ®å¯¼å…¥æ“ä½œï¼Œè¯·å°†å›¾ä¹¦é¦†æ•°æ®å¯¼å…¥åˆ°æ‚¨çš„æ•°æ®åº“é›†ç¾¤ä¸­ã€‚  Atlas UIMongoDB Shell åœ¨èšåˆç®¡é“æ„å»ºå™¨ä¸­é€‰æ‹©æ­£ç¡®çš„æ•°æ®åº“ã€‚ ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ¯ æ€»ç»“","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/summary","content":"ğŸ¯ æ€»ç»“ æ­å–œï¼é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»æˆåŠŸåœ°ï¼š ä½¿ç”¨èšåˆç®¡é“æ¡†æ¶æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ä½¿ç”¨èšåˆç®¡é“æ‰§è¡Œåˆ†ç»„ã€è½¬æ¢å’Œèšåˆæ“ä½œä»ç®¡é“ä¸­å¯¼å‡ºæ•°æ® åç»­æ‚¨å¯ä»¥è®¿é—® MongoDB å¼€å‘è€…ä¸­å¿ƒ è·å–æ›´å¤šæœ‰ç”¨çš„ä¿¡æ¯å’Œæ•™ç¨‹ã€‚","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ $match","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/match","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"è¡¨è¾¾å¼â€‹","type":1,"pageTitle":"ğŸ‘ $match","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/match#è¡¨è¾¾å¼","content":" $match æ“ä½œç¬¦ä¸­çš„ &lt;expression&gt; éƒ¨åˆ†å¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„ MongoDB è¡¨è¾¾å¼ã€‚è¿™åŒ…æ‹¬ï¼š  æ¯”è¾ƒæ“ä½œç¬¦ï¼šeqã€neqã€gteã€lteã€gtã€ltã€inã€ninã€existsæ­£åˆ™è¡¨è¾¾å¼ï¼šregexé€»è¾‘æ“ä½œç¬¦ï¼šandã€orã€notå­æ–‡æ¡£å’Œæ•°ç»„ï¼š{ field: &lt;value&gt; }, [ &lt;item&gt;, &lt;item&gt;, ... ]  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"åŒ¹é…ä¹¦ç±æ–‡æ¡£â€‹","type":1,"pageTitle":"ğŸ‘ $match","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/match#åŒ¹é…ä¹¦ç±æ–‡æ¡£","content":" Atlas UIMongoDB Shell é¦–å…ˆï¼Œç¡®ä¿åœ¨ Atlas UI ä¸­é€‰æ‹© books é›†åˆã€‚ ç„¶åï¼Œå¯¼èˆªåˆ° Aggregation é€‰é¡¹å¡å¹¶ç‚¹å‡» Add Stageã€‚ å‡è®¾æˆ‘ä»¬æƒ³è¦æ‰€æœ‰ 2010 å¹´çš„ä¹¦ç±ã€‚æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª $match é˜¶æ®µæ¥è¿‡æ»¤ books é›†åˆä¸­çš„æ–‡æ¡£ï¼š [ { $match: { year: 2010 } } ]   ğŸ‘ è¿”å›æ‰€æœ‰æœ‰æ°å¥½ 100 é¡µçš„ booksã€‚  ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $match: { pages: 100 } } ]   ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ANDâ€‹","type":1,"pageTitle":"ğŸ‘ $match","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/match#and","content":" å¦‚æœæˆ‘ä»¬éœ€è¦ä½¿ç”¨ AND æ·»åŠ æ›´å¤šæ¡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ $and æ“ä½œç¬¦ã€‚  å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰€æœ‰æœ‰ 100 é¡µå¹¶ä¸” totalInventory æ°å¥½ä¸º 2 çš„ä¹¦ç±ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ $and æ“ä½œç¬¦ã€‚è¿™ä¸ªæ“ä½œç¬¦æ¥å—ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ¡ä»¶çš„æ–‡æ¡£æ•°ç»„ï¼Œè¿™äº›æ¡ä»¶éƒ½å¿…é¡»ä¸ºçœŸï¼ŒAND æ“ä½œæ‰ä¼šæˆåŠŸï¼š  Atlas UIMongoDB Shell [ { $match: { $and: [ { pages: 100 }, { totalInventory: 2 } ] } } ]   ä¼ªä»£ç å¦‚ä¸‹ï¼š  IF pages == 100 AND totalInventory == 2 { return matching docs }   ğŸ‘ è¿”å›æ‰€æœ‰ 2015 å¹´çš„ booksï¼Œè¿™äº›ä¹¦ç±æ°å¥½æœ‰ 100 é¡µã€‚  ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $match: { $and: [ { pages: 100 }, { year: 2015 } ] } } ]   ğŸ‘ å®ƒä»¬æœ‰å¤šå°‘ï¼Ÿ  ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $match: { $and: [ { pages: 100 }, { year: 2015 } ] } }, { $count: &quot;books_count&quot; } ]   ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ç®€å†™ ANDâ€‹","type":1,"pageTitle":"ğŸ‘ $match","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/match#ç®€å†™-and","content":" æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ é€’åŒ…å«æ‰€æœ‰æ¡ä»¶çš„æ–‡æ¡£æ¥è¿›è¡Œéšå¼ ANDï¼ˆè€Œä¸æ˜¯æ–‡æ¡£æ•°ç»„ï¼‰ï¼š  Atlas UIMongoDB Shell [ { $match: {pages: 100, totalInventory: 2} } ]   ğŸ‘ ä½¿ç”¨ç®€å•çš„ $and è¯­æ³•è¿”å›æ‰€æœ‰ 2015 å¹´çš„ booksï¼Œè¿™äº›ä¹¦ç±æ°å¥½æœ‰ 100 é¡µ  ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $match: {pages: 100, year: 2015} } ]  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h3"},{"title":"ğŸ‘ ç¼–å†™é•¿ç®¡é“","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/writing-long-pipelines","content":"ğŸ‘ ç¼–å†™é•¿ç®¡é“ èšåˆç®¡é“å¯èƒ½ä¼šå˜å¾—å¾ˆé•¿ï¼Œè¿™å–å†³äºæˆ‘ä»¬éœ€è¦è¿è¡Œå¤šå°‘é˜¶æ®µã€‚ç¼–å†™ç®¡é“å°±æ˜¯ç¼–å†™ä»£ç ï¼Œå› ä¸ºä½ å°†ä½¿ç”¨ä½ è‡ªå·±ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€ä¸­çš„ MongoDB é©±åŠ¨ç¨‹åºï¼ˆSDKï¼‰æ¥ç¼–å†™å®ƒã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é€‚ç”¨äº MongoDB Shell mongosh çš„ JavaScript ç¤ºä¾‹ã€‚ä½†å¦‚æœä½ åœ¨ç”¨ Rust ç¼–å†™ä¸€ä¸ªå¾®æœåŠ¡ï¼Œä½ è‚¯å®šä¼šç”¨ Rust ç¼–å†™ä½ çš„ç®¡é“ï¼Œå…¶ä»–ç¼–ç¨‹è¯­è¨€åŒç†ã€‚ å±é™© ä»¥ä¸‹è¯­æ³•åœ¨ Atlas UI èšåˆç¼–è¾‘å™¨ä¸­ä¸èƒ½ä½¿ç”¨ã€‚UI ç¼–è¾‘å™¨ä¸æ”¯æŒå£°æ˜å˜é‡ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥åƒè¿™æ ·é‡å†™æˆ‘ä»¬æœ€åçš„ç®¡é“ï¼š è·å– 1985 å¹´æœ‰ 150 é¡µçš„ 15 æœ¬ä¹¦ã€‚ä»…æ˜¾ç¤º titleã€yearã€totalInventory å’Œ available å­—æ®µã€‚ (ç¤ºä¾‹æ–‡æ¡£ è¿™é‡Œ) db.books.aggregate([ {$match: {year: 1985, pages: 150}}, {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1}}, {$limit: 15} ]) å°†è¢«æ›´æ”¹ä¸ºï¼š let booksFrom1985With150pages = {$match: {year: 1985, pages: 150}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1}}; let getJust15books = {$limit: 15}; db.books.aggregate([ booksFrom1985With150pages, showOnlyTheseFields, getJust15books, ]); æ›´æ”¹åæ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ï¼Œå¯¹å§ï¼Ÿ ğŸ‘ å°è¯•è¿è¡Œä¸Šè¿°ç®¡é“å¹¶æ¯”è¾ƒä½ çš„ç»“æœï¼šåº”è¯¥ä¸ä¹‹å‰ç›¸åŒ æç¤º æ‚¨å¯ä»¥åƒåœ¨ç¼–ç¨‹è¯­è¨€ä¸­ç»„åˆå‡½æ•°ä¸€æ ·ç¼–å†™ä½ çš„èšåˆç®¡é“ã€‚èšåˆ æ˜¯ æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ä»£ç ã€‚åœ¨å®¢æˆ·ç«¯ä½ åªæ˜¯è¡¨è¾¾ éœ€è¦ åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯ å¦‚ä½• è¿›è¡Œæ“ä½œã€‚ æç¤º ç”±äºè¿™æ˜¯ä»£ç ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨ç®¡é“ä¸­æ·»åŠ æ³¨é‡Šï¼ˆä»¥ // å¼€å¤´ï¼‰ ğŸ‘ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ $gte è·å– 150 é¡µæˆ–æ›´å¤šçš„ä¹¦ã€‚æ£€æŸ¥ æ–‡æ¡£ ä¸­çš„ $gte è¯­æ³•ï¼Œå¹¶ç¼–å†™ä¸€ä¸ªèšåˆç®¡é“ä»¥è¿”å› 1985 å¹´è¶…è¿‡ 150 é¡µçš„ 15 æœ¬ä¹¦ã€‚ä»…æ˜¾ç¤º titleã€yearã€totalInventory å’Œ available å­—æ®µã€‚ (ç¤ºä¾‹æ–‡æ¡£ è¿™é‡Œ) æç¤º: æˆ‘ä»¬éœ€è¦ä½¿ç”¨ $andï¼Œå› ä¸ºè¿™å¯èƒ½æœ‰ç‚¹å¤æ‚ã€‚ ç­”æ¡ˆ let moreThan150pages = {pages: {$gte: 150}} let booksFrom1985WithMoreThan150pages = {$match: {$and: [{year: 1985}, moreThan150pages]}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1}}; let getJust15books = {$limit: 15}; db.books.aggregate([ booksFrom1985WithMoreThan150pages, showOnlyTheseFields, getJust15books, ]); ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ ç®€å•æ•°ç»„æŸ¥è¯¢","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/using-arrays/simple-match-array","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ‘ $project","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/project","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"åœ¨è¾“å‡ºä¸­åŒ…æ‹¬ç‰¹å®šå­—æ®µâ€‹","type":1,"pageTitle":"ğŸ‘ $project","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/project#åœ¨è¾“å‡ºä¸­åŒ…æ‹¬ç‰¹å®šå­—æ®µ","content":" books é›†åˆä¸­çš„æ–‡æ¡£å¦‚ä¸‹æ‰€ç¤ºï¼š  { _id: '0395623650', title: 'Platero y yo / Platero and I (Spanish-English Bilingual Edition) (English and Spanish Edition)', authors: [ { _id: '64cc2db4830ba29148db5180', name: 'Juan RamÃ³n JimÃ©nez' } ], pages: 64, year: 1994, synopsis: 'Selections from a classic of world literature present a picture of life in the town of Moguer, in Andalusia, Spain.\\n' + '\\n' + '\\n' + ' Presents a picture of life in the town of Moguer, in Andalusia, Spain, as seen through the eyes of a wandering poet and his faithful donkey.\\n', cover: 'https://images.isbndb.com/covers/36/57/9780395623657.jpg', attributes: [ { key: 'edition', value: 'F First Edition Thus' }, { key: 'dimensions', value: 'Height: 10.499979 Inches, Length: 6.999986 Inches, Weight: 2.0502990366 Pounds, Width: 0.12499975 Inches' }, { key: 'isbn13', value: '9780395623657' }, { key: 'msrp', value: 1.99 }, { key: 'isbn', value: '0395623650' }, { key: 'isbn10', value: '0395623650' } ], totalInventory: 1, available: 1, binding: 'Hardcover', language: 'en', longTitle: 'Platero y yo / Platero and I (Spanish-English Bilingual Edition) (English and Spanish Edition)', publisher: 'Clarion Books' }   å¦‚æœæˆ‘ä»¬åªå¯¹ä¹¦åæ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ $project é€‰æ‹©æˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—æ®µã€‚ä¾‹å¦‚ï¼Œè¦åªè·å–ä¹¦åå’Œå¹´ä»½ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š  Atlas UIMongoDB Shell [ { $project: {title: 1, year: 1} } ]   1 è¡¨ç¤ºâ€œæ˜¾ç¤ºè¯¥å­—æ®µâ€0 è¡¨ç¤ºâ€œéšè—è¯¥å­—æ®µâ€ä¸»é”® _id å­—æ®µé»˜è®¤æ˜¾ç¤º  æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ’é™¤å­—æ®µï¼Œå¹¶æ˜¾ç¤ºé™¤ attributes ä¹‹å¤–çš„æ‰€æœ‰å­—æ®µï¼š  Atlas UIMongoDB Shell [ { $project: {attributes: 0} } ]   ğŸ‘ ä»…æ˜¾ç¤º title å’Œ coverã€‚  ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $project: {title: 1, cover: 1} } ]   ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"æ’é™¤å­—æ®µâ€‹","type":1,"pageTitle":"ğŸ‘ $project","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/project#æ’é™¤å­—æ®µ","content":" ğŸ‘ ä»ç»“æœä¸­æ’é™¤ coverã€attributes å’Œ _id å­—æ®µã€‚  ç­”æ¡ˆ Atlas UIMongoDB Shell [ { $project: {_id: 0, attributes: 0, cover: 0} } ]   ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"åŒ…æ‹¬å’Œæ’é™¤å­—æ®µâ€‹","type":1,"pageTitle":"ğŸ‘ $project","url":"/aggregation-pipeline-lab/zh/docs/simple-queries/project#åŒ…æ‹¬å’Œæ’é™¤å­—æ®µ","content":" å±é™© åœ¨åŒä¸€ä¸ª $project ä¸­ä¸èƒ½åŒæ—¶åŒ…æ‹¬å’Œæ’é™¤å­—æ®µï¼šå¦‚æœä½ å¼€å§‹åŒ…æ‹¬å­—æ®µï¼Œä½ å¿…é¡»ä¸€ç›´åŒ…æ‹¬å­—æ®µï¼Œåä¹‹äº¦ç„¶ã€‚  ä¾‹å¦‚ï¼Œè¿™å°†å¤±è´¥ï¼š  db.books.aggregate([{$project: {title: 1, attributes: 0}}]) MongoServerError: Invalid $project :: caused by :: Cannot do exclusion on field attributes in inclusion projection   ä¿¡æ¯ è¿™ä¸ªè§„åˆ™çš„å”¯ä¸€ä¾‹å¤–æ˜¯ _id å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŒ…æ‹¬å­—æ®µçš„ $project ä¸­æ’é™¤å®ƒã€‚  db.books.aggregate([{$project: {title: 1, _id: 0}}])  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ‘ åœ¨æ•°ç»„ä¸­çš„å¯¹è±¡å†…æœç´¢","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/using-arrays/search-inside-objects-in-arrays","content":"ğŸ‘ åœ¨æ•°ç»„ä¸­çš„å¯¹è±¡å†…æœç´¢ åœ¨æˆ‘ä»¬çš„ä¹¦ç±ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Attribute Pattern æ¥åœ¨æ–‡æ¡£ä¸­æ‹¥æœ‰ä¸åŒçš„å±æ€§ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ æ ·æœ¬æ–‡æ¡£ ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªattributesæ•°ç»„ï¼ŒåŒ…å«å‡ ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡å…·æœ‰ç›¸åŒçš„ç»“æ„ï¼š attributes: [ { key: 'edition', value: '1st' }, { key: 'dimensions', value: 'Height: 1.111 Inches, Length: 1.111 Inches, Weight: 0.2 Pounds, Width: 1.111 Inches' }, { key: 'isbn13', value: '9780765342508' }, { key: 'msrp', value: 6.99 }, { key: 'isbn', value: '0765342502' }, { key: 'isbn10', value: '0765342502' } ], æˆ‘ä»¬å¦‚ä½•æœç´¢æ‰€æœ‰å”®ä»·ä¸º9.99çš„ä¹¦ç±ï¼Ÿæˆ‘ä»¬æƒ³è¦åœ¨attributesä¸­æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶é”®ä¸ºmsrpä¸”å€¼ä¸º9.99çš„ä¹¦ç±ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®ç°ï¼š db.books.aggregate([ { $unwind : &quot;$attributes&quot; }, {$match: {&quot;attributes.key&quot;: &quot;msrp&quot;, &quot;attributes.value&quot;: 9.99} }, {$project: {title: 1, attributes: 1}} ]); åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸º$attributesæ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡è·å–æ¯æœ¬ä¹¦çš„å‰¯æœ¬ã€‚è¿™å°†&quot;å±•å¼€&quot;æ•°ç»„å¹¶è¿”å›ç›¸åŒæ–‡æ¡£çš„å¤šä¸ªå‰¯æœ¬ï¼Œæ¯ä¸ªå‰¯æœ¬å…·æœ‰ä¸åŒçš„å±æ€§ï¼Œè¿™äº›å±æ€§å¯¹äºæ¯ä¸ªç”Ÿæˆçš„æ–‡æ¡£éƒ½æ˜¯ä¸åŒçš„ã€‚ ğŸ‘ ä¸ºäº†æ›´å¥½åœ°ç†è§£$unwindï¼Œè¿è¡Œæ­¤èšåˆ db.books.aggregate([ { $match: {_id: &quot;0395623650&quot;} }, { $unwind : &quot;$attributes&quot; }, ]); ä½ åº”è¯¥ä¼šä¸ºåŸä¹¦çš„æ¯ä¸ªå±æ€§è·å–ä¸€ä¸ªæ–‡æ¡£ã€‚ ä½†ä½ å®é™…ä¸Šå¯ä»¥æ›´ç›´æ¥åœ°åŒ¹é…æ•°ç»„ä¸­çš„æ–‡æ¡£ï¼š let nineNinetyNine = {$match: {&quot;attributes.key&quot;: &quot;msrp&quot;, &quot;attributes.value&quot;: 9.99}}; let showOnlyTheseFields = {$project: {_id: 0, title: 1, year: 1, totalInventory: 1, available: 1, &quot;attributes&quot;: 1}}; db.books.aggregate([ nineNinetyNine, showOnlyTheseFields, ]); ","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æ•°æ®â€‹","type":1,"pageTitle":"ğŸ‘ ç®€å•æ•°ç»„æŸ¥è¯¢","url":"/aggregation-pipeline-lab/zh/docs/using-arrays/simple-match-array#åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æ•°æ®","content":" ä¸€ä¸ª JSON æ•°ç»„å¯ä»¥åŒ…å«æ ‡é‡å€¼æˆ–å¯¹è±¡ã€‚åœ¨æˆ‘ä»¬çš„æ•°æ®ä¸­ï¼Œauthors æœ‰ä¸€ä¸ªåŒ…å«ä»–ä»¬åˆ›ä½œçš„ä¹¦ç±ï¼ˆä»–ä»¬çš„ ISBNï¼‰çš„æ•°ç»„ã€‚è®©æˆ‘ä»¬è·å–ä¸€ä¸ªä½œè€…ï¼š  db.authors.aggregate([{$limit: 1}])   ğŸ‘ è¿è¡Œæ­¤èšåˆä»¥è·å–ä¸€ä¸ªä½œè€…  æˆ‘å¾—åˆ°äº†è¿™ä¸ªï¼ˆå¯èƒ½ä¼šæ ¹æ®ä½ å¯¼å…¥çš„æ•°æ®æºè€Œå˜åŒ–ï¼‰  { _id: ObjectId(&quot;64cc2db4830ba29148da4c3b&quot;), name: 'Richard Bruce Wright', sanitizedName: 'richardbrucewright', books: [ '0002005018' ], aliases: [ 'Wright, Richard Bruce' ] }   æˆ‘èƒ½è·å–ä¹¦ç± 0002005018 çš„æ‰€æœ‰ä½œè€…å—ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘æƒ³è¦æ‰€æœ‰åœ¨ books æ•°ç»„ä¸­åŒ…å« 0002005018 çš„ä½œè€…ã€‚äº‹å®è¯æ˜è¿™éå¸¸ç®€å•ï¼š  db.authors.aggregate([ {$match: {books: &quot;0002005018&quot;}} ])   ğŸ‘ è·å– ISBN ä¸º 0395623650 çš„ä¹¦ç±çš„ä½œè€…å§“åï¼š  ç­”æ¡ˆ db.authors.aggregate([{$match: {books: &quot;0395623650&quot;}}]) &gt; name: 'Juan RamÃ³n JimÃ©nez',   ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"æ•°ç»„çš„å¤§å°â€‹","type":1,"pageTitle":"ğŸ‘ ç®€å•æ•°ç»„æŸ¥è¯¢","url":"/aggregation-pipeline-lab/zh/docs/using-arrays/simple-match-array#æ•°ç»„çš„å¤§å°","content":" å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“ä¸€ä¸ªä½œè€…æœ‰å¤šå°‘æœ¬ä¹¦æ€ä¹ˆåŠï¼Ÿä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ $sizeï¼Œæ·»åŠ æˆ‘ä»¬éœ€è¦çŸ¥é“å¤§å°çš„æ•°ç»„å­—æ®µï¼š  db.authors.aggregate([ {$project: { name: 1, bookCount: {$size: &quot;$books&quot;} } }, ])   ğŸ‘ è°å†™çš„ä¹¦æœ€å¤šï¼Ÿï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ { $sort: {&quot;bookCount&quot;: -1}} è¿›è¡Œæ’åºï¼‰  ç­”æ¡ˆ let addNumberBooks = { $project: { name: 1, bookCount: {$size: &quot;$books&quot;} } } let orderByNumberOfBooksDesc = { $sort: {&quot;bookCount&quot;: -1}} let getOne = {$limit: 1} db.authors.aggregate([ addNumberBooks, orderByNumberOfBooksDesc, getOne, ])  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ“˜ ä»€ä¹ˆæ˜¯èšåˆç®¡é“","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/what-is-aggregation/what-is-aggregation","content":"ğŸ“˜ ä»€ä¹ˆæ˜¯èšåˆç®¡é“ èšåˆç®¡é“ç±»ä¼¼äºä½¿ç”¨ç®¡é“è¿æ¥çš„ Unix å‘½ä»¤ã€‚ æˆ‘ä»¬å¯ä»¥æ„å»ºæ¨¡å—åŒ–ã€å¯ç»„åˆçš„å¤„ç†ç®¡é“ã€‚ ä¸€ä¸ªèšåˆç®¡é“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†æ–‡æ¡£çš„ é˜¶æ®µ(stage) ç»„æˆï¼š æ¯ä¸ªé˜¶æ®µå¯¹è¾“å…¥æ–‡æ¡£æ‰§è¡Œä¸€ä¸ªæ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé˜¶æ®µå¯ä»¥è¿‡æ»¤æ–‡æ¡£ã€åˆ†ç»„æ–‡æ¡£å’Œè®¡ç®—å€¼ã€‚ ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºæ–‡æ¡£è¢«ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚ èšåˆç®¡é“å¯ä»¥è¿”å›æ–‡æ¡£ç»„çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œè¿”å›æ€»å€¼ã€å¹³å‡å€¼ã€æœ€å¤§å€¼å’Œæœ€å°å€¼ç­‰ã€‚","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ğŸ“˜ SQL ä¸èšåˆ","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/what-is-aggregation/sql-vs-aggregation","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"SQLâ€‹","type":1,"pageTitle":"ğŸ“˜ SQL ä¸èšåˆ","url":"/aggregation-pipeline-lab/zh/docs/what-is-aggregation/sql-vs-aggregation#sql","content":" ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥é€šå¸¸ä»¥ SELECT å¼€å§‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ—å‡ºæ‰€éœ€çš„å­—æ®µï¼Œç„¶åæ˜¯ FROM å­å¥æ¥æŒ‡å®šå°†è¿”å›è¡Œçš„è¡¨ï¼ˆæˆ–åœ¨æœ¬ä¾‹ä¸­ä¸ºå­æŸ¥è¯¢ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ WHERE è¿›è¡Œç­›é€‰ï¼Œå¹¶ä½¿ç”¨ GROUP å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚  æˆ‘ä»¬ä»è¯»å– SQL éœ€ä»åµŒå¥—ä¸­ç†è§£æ•´ä¸ªè¯­å¥çš„å«ä¹‰ã€‚å¦‚æœåµŒå¥—è¿‡å¤šï¼Œåˆ™ä¸æ˜“ç†è§£ã€‚  SELECT city, SUM(annual_spend) Total_Spend, AVG(annual_spend) Average_Spend, MAX(annual_spend) Max_Spend, COUNT(annual_spend) customers FROM ( SELECT t1.city, customer.annual_spend FROM customer LEFT JOIN ( SELECT address.address_id, city.city, address.customer_id, address.location FROM address LEFT JOIN city ON address.city_id = city.city_id ) AS t1 ON (customer.customer_id = t1.customer_id AND t1.location = &quot;home&quot;) ) AS t2 GROUP BY city;   ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ç­‰æ•ˆçš„ MongoDB èšåˆç®¡é“â€‹","type":1,"pageTitle":"ğŸ“˜ SQL ä¸èšåˆ","url":"/aggregation-pipeline-lab/zh/docs/what-is-aggregation/sql-vs-aggregation#ç­‰æ•ˆï¿½ï¿½çš„-mongodb-èšåˆç®¡é“","content":" åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªè¿”å› address æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„æ–‡æ¡£ï¼Œç„¶åæˆ‘ä»¬ç­›é€‰å‡ºä»…åŒ…å« home åœ°å€ä½ç½®çš„æ–‡æ¡£ï¼Œæœ€åæˆ‘ä»¬è¿›è¡Œåˆ†ç»„ã€‚æ­£å¦‚æˆ‘ä»¬å°†åŠ¨æ‰‹å®è·µå¹¶çœ‹åˆ°çš„ï¼ŒMongoDB èšåˆç®¡é“å¯ä»¥åˆ†å¼€æµ‹è¯•ï¼Œå¹¶ä¸”è¿è¡Œé€»è¾‘ç±»ä¼¼äºæˆ‘ä»¬çš„ä»£ç ç»“æ„æœ¬èº«ã€‚  db.customers.aggregate([ { $unwind: &quot;$address&quot;, }, { $match: {&quot;address.location&quot;: &quot;home&quot;} }, { $group: { _id: &quot;$address.city&quot;, totalSpend: {$sum: &quot;$annualSpend&quot;}, averageSpend: {$avg: &quot;$annualSpend&quot;}, maximumSpend: {$max: &quot;$annualSpend&quot;}, customers: {$sum: 1} } } ])   ä¿¡æ¯ å¦è¯·å‚é˜… SQL ä¸èšåˆæ˜ å°„è¡¨ ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"},{"title":"ğŸ“˜ èšåˆç®¡é“çš„ç»“æ„","type":0,"sectionRef":"#","url":"/aggregation-pipeline-lab/zh/docs/what-is-aggregation/structure-aggregation","content":"","keywords":"","version":"å½“å‰ç‰ˆæœ¬"},{"title":"ç¤ºä¾‹â€‹","type":1,"pageTitle":"ğŸ“˜ èšåˆç®¡é“çš„ç»“æ„","url":"/aggregation-pipeline-lab/zh/docs/what-is-aggregation/structure-aggregation#ç¤ºä¾‹","content":" ä¸€ä¸ªæ‰§è¡Œä¸Šè¿° SQL è¯­å¥çš„èšåˆç®¡é“ç¤ºä¾‹å¦‚ä¸‹ï¼š  db.mycollection.aggregate([ { $sort: /** * æä¾›ä»»æ„æ•°é‡çš„å­—æ®µ/æ’åºå¯¹ã€‚ */ { num_mflix_comments: -1, }, }, { $limit: /** * æä¾›è¦é™åˆ¶çš„æ–‡æ¡£æ•°é‡ã€‚ */ 1, }, { $unwind: /** * path: æ•°ç»„å­—æ®µçš„è·¯å¾„ã€‚ * includeArrayIndex: ç´¢å¼•åç§°ï¼ˆå¯é€‰ï¼‰ã€‚ * preserveNullAndEmptyArrays: å±•å¼€ null å’Œç©ºå€¼ï¼ˆå¯é€‰ï¼‰ã€‚ */ { path: &quot;$cast&quot;, }, }, { $project: /** * è§„èŒƒï¼šè¦åŒ…å«æˆ–æ’é™¤çš„å­—æ®µã€‚ */ { cast: 1, }, }, ])  ","version":"å½“å‰ç‰ˆæœ¬","tagName":"h2"}],"options":{"languages":["en","zh"],"id":"default"}}