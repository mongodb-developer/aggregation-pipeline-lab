# ğŸ‘ ç®€å•æ•°ç»„æŸ¥è¯¢

## åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æ•°æ®

ä¸€ä¸ª JSON æ•°ç»„å¯ä»¥åŒ…å«æ ‡é‡å€¼æˆ–å¯¹è±¡ã€‚åœ¨æˆ‘ä»¬çš„æ•°æ®ä¸­ï¼Œ`authors` æœ‰ä¸€ä¸ªåŒ…å«ä»–ä»¬åˆ›ä½œçš„ä¹¦ç±ï¼ˆä»–ä»¬çš„ ISBNï¼‰çš„æ•°ç»„ã€‚è®©æˆ‘ä»¬è·å–ä¸€ä¸ªä½œè€…ï¼š

```js
db.authors.aggregate([{$limit: 1}])
```

ğŸ‘ è¿è¡Œæ­¤èšåˆä»¥è·å–ä¸€ä¸ªä½œè€…

æˆ‘å¾—åˆ°äº†è¿™ä¸ªï¼ˆå¯èƒ½ä¼šæ ¹æ®ä½ å¯¼å…¥çš„æ•°æ®æºè€Œå˜åŒ–ï¼‰

```js
{
  _id: ObjectId("64cc2db4830ba29148da4c3b"),
  name: 'Richard Bruce Wright',
  sanitizedName: 'richardbrucewright',
  books: [
    '0002005018'
  ],
  aliases: [
    'Wright, Richard Bruce'
  ]
}
```

æˆ‘èƒ½è·å–ä¹¦ç± `0002005018` çš„æ‰€æœ‰ä½œè€…å—ï¼Ÿä¸ºæ­¤ï¼Œæˆ‘æƒ³è¦æ‰€æœ‰åœ¨ `books` æ•°ç»„ä¸­åŒ…å« `0002005018` çš„ä½œè€…ã€‚äº‹å®è¯æ˜è¿™éå¸¸ç®€å•ï¼š

```js
db.authors.aggregate([
    {$match: {books: "0002005018"}}
])
```

ğŸ‘ è·å– ISBN ä¸º `0395623650` çš„ä¹¦ç±çš„ä½œè€…å§“åï¼š

<details>
<summary>ç­”æ¡ˆ</summary>
<div>

```js
db.authors.aggregate([{$match: {books: "0395623650"}}])

>   name: 'Juan RamÃ³n JimÃ©nez',
```
</div>
</details>

## æ•°ç»„çš„å¤§å°

å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“ä¸€ä¸ªä½œè€…æœ‰å¤šå°‘æœ¬ä¹¦æ€ä¹ˆåŠï¼Ÿä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `$size`ï¼Œæ·»åŠ æˆ‘ä»¬éœ€è¦çŸ¥é“å¤§å°çš„æ•°ç»„å­—æ®µï¼š

```js
db.authors.aggregate([
{$project: {
    name: 1,
    bookCount: {$size: "$books"}
 }
},
])
```

ğŸ‘ è°å†™çš„ä¹¦æœ€å¤šï¼Ÿï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `{ $sort: {"bookCount": -1}}` è¿›è¡Œæ’åºï¼‰

<details>
<summary>ç­”æ¡ˆ</summary>
<div>

```js
let addNumberBooks = {
    $project: {
        name: 1,
        bookCount: {$size: "$books"}
    }
}

let orderByNumberOfBooksDesc = { $sort: {"bookCount": -1}}

let getOne = {$limit: 1}

db.authors.aggregate([
    addNumberBooks,
    orderByNumberOfBooksDesc,
    getOne,
])
```
</div>
</details>