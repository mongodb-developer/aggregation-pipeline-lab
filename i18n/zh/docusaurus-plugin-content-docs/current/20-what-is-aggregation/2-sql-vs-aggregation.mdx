---
description: è®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ SQL å’Œèšåˆç®¡é“
---

# ğŸ“˜ SQL ä¸èšåˆ

## SQL

ä¸€ä¸ª SQL æŸ¥è¯¢è¯­å¥é€šå¸¸ä»¥ `SELECT` å¼€å§‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ—å‡ºæ‰€éœ€çš„å­—æ®µï¼Œç„¶åæ˜¯ `FROM` å­å¥æ¥æŒ‡å®šå°†è¿”å›è¡Œçš„è¡¨ï¼ˆæˆ–åœ¨æœ¬ä¾‹ä¸­ä¸ºå­æŸ¥è¯¢ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `WHERE` è¿›è¡Œç­›é€‰ï¼Œå¹¶ä½¿ç”¨ `GROUP` å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚

æˆ‘ä»¬ä»è¯»å– SQL éœ€ä»åµŒå¥—ä¸­ç†è§£æ•´ä¸ªè¯­å¥çš„å«ä¹‰ã€‚å¦‚æœåµŒå¥—è¿‡å¤šï¼Œåˆ™ä¸æ˜“ç†è§£ã€‚

```sql
SELECT
    city,
    SUM(annual_spend) Total_Spend,
    AVG(annual_spend) Average_Spend,
    MAX(annual_spend) Max_Spend,
    COUNT(annual_spend) customers
FROM (
    SELECT t1.city, customer.annual_spend
    FROM customer 
    LEFT JOIN (
        SELECT address.address_id, city.city,
               address.customer_id, address.location
        FROM address LEFT JOIN city
        ON address.city_id = city.city_id
        ) AS t1
    ON
    (customer.customer_id = t1.customer_id AND
              t1.location = "home")
) AS t2
GROUP BY city;
```

## ç­‰æ•ˆçš„ MongoDB èšåˆç®¡é“

åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªè¿”å› `address` æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„æ–‡æ¡£ï¼Œç„¶åæˆ‘ä»¬ç­›é€‰å‡ºä»…åŒ…å« `home` åœ°å€ä½ç½®çš„æ–‡æ¡£ï¼Œæœ€åæˆ‘ä»¬è¿›è¡Œåˆ†ç»„ã€‚æ­£å¦‚æˆ‘ä»¬å°†åŠ¨æ‰‹å®è·µå¹¶çœ‹åˆ°çš„ï¼ŒMongoDB èšåˆç®¡é“å¯ä»¥åˆ†å¼€æµ‹è¯•ï¼Œå¹¶ä¸”è¿è¡Œé€»è¾‘ç±»ä¼¼äºæˆ‘ä»¬çš„ä»£ç ç»“æ„æœ¬èº«ã€‚

```js
db.customers.aggregate([
	{
		$unwind: "$address",
	},
	{
		$match: {"address.location": "home"}
	},
	{
		 $group: {
			_id: "$address.city",
			totalSpend: {$sum: "$annualSpend"},
			averageSpend: {$avg: "$annualSpend"},
			maximumSpend: {$max: "$annualSpend"},
			customers: {$sum: 1}
		}
	}
])
```

:::info
å¦è¯·å‚é˜… [SQL ä¸èšåˆæ˜ å°„è¡¨](https://www.mongodb.com/docs/manual/reference/sql-aggregation-comparison/)
:::