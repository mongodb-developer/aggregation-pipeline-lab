---
description: æŸ¥çœ‹ç»„æˆèšåˆç®¡é“çš„éƒ¨åˆ†
---

# ğŸ“˜ èšåˆç®¡é“çš„ç»“æ„

é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ SQL è¿™ç§ç¬¬å››ä»£è¯­è¨€æ¥ä¸å…³ç³»å‹æ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚è€Œåœ¨ MongoDB ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¢é‡æ­¥éª¤æ¥è·å–å’Œè½¬æ¢æ•°æ®ã€‚

ä¸€ä¸ªèšåˆç®¡é“æ˜¯ç”± [__é˜¶æ®µ__](https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/) ç»„æˆçš„ã€‚

æˆ‘ä»¬å°†ä¸€ä¸ªåŒ…å«å¤šä¸ªé˜¶æ®µçš„æ•°ç»„ä¼ é€’ç»™ `aggregate` æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
db.mycollection.aggregate([
    stage1,
    stage2,
    stage3
])
```

## ç¤ºä¾‹

ä¸€ä¸ªæ‰§è¡Œä¸Šè¿° SQL è¯­å¥çš„èšåˆç®¡é“ç¤ºä¾‹å¦‚ä¸‹ï¼š

```
db.mycollection.aggregate([
  {
    $sort:
      /**
       * æä¾›ä»»æ„æ•°é‡çš„å­—æ®µ/æ’åºå¯¹ã€‚
       */
      {
        num_mflix_comments: -1,
      },
  },
  {
    $limit:
      /**
       * æä¾›è¦é™åˆ¶çš„æ–‡æ¡£æ•°é‡ã€‚
       */
      1,
  },
  {
    $unwind:
      /**
       * path: æ•°ç»„å­—æ®µçš„è·¯å¾„ã€‚
       * includeArrayIndex: ç´¢å¼•åç§°ï¼ˆå¯é€‰ï¼‰ã€‚
       * preserveNullAndEmptyArrays: å±•å¼€ null å’Œç©ºå€¼ï¼ˆå¯é€‰ï¼‰ã€‚
       */
      {
        path: "$cast",
      },
  },
  {
    $project:
      /**
       * è§„èŒƒï¼šè¦åŒ…å«æˆ–æ’é™¤çš„å­—æ®µã€‚
       */
      {
        cast: 1,
      },
  },
])
```