"use strict";(self.webpackChunkaggregation_pipeline_workshop=self.webpackChunkaggregation_pipeline_workshop||[]).push([[1865],{1461:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>l,metadata:()=>u,toc:()=>d});var t=o(4848),a=o(8453),r=o(1470),s=o(9365);const l={},i="\ud83d\udc50 Lookups, AKA Left Outer Join",u={id:"lookups/lookups",title:"\ud83d\udc50 Lookups, AKA Left Outer Join",description:"Using documents, we usually model 1many relationships by embedding documents inside other documents, and even using arrays. For instance, an author can have many aliases, and they live inside an array in the authors collection.",source:"@site/docs/60-lookups/1-lookups.mdx",sourceDirName:"60-lookups",slug:"/lookups/lookups",permalink:"/aggregation-pipeline-lab/docs/lookups/lookups",draft:!1,unlisted:!1,editUrl:"https://github.com/mongodb-developer/aggregation-pipeline-lab/blob/main/docs/60-lookups/1-lookups.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lookups / Joins",permalink:"/aggregation-pipeline-lab/docs/category/lookups--joins"},next:{title:"\ud83e\uddb8\u200d\u2642\ufe0f Advanced lookups",permalink:"/aggregation-pipeline-lab/docs/lookups/advanced-lookups"}},c={},d=[{value:"Lookups from a previous stage",id:"lookups-from-a-previous-stage",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"-lookups-aka-left-outer-join",children:"\ud83d\udc50 Lookups, AKA Left Outer Join"})}),"\n",(0,t.jsxs)(n.p,{children:["Using documents, we usually model 1:1 and 1",":many"," relationships by embedding documents inside other documents, and even using arrays. For instance, an author can have many aliases, and they live inside an array in the ",(0,t.jsx)(n.code,{children:"authors"})," collection."]}),"\n",(0,t.jsxs)(n.p,{children:["But other times, we need to use references to those documents instead of embedding them. For instance, an author has an array of the books they have written, but instead of moving the book documents inside an array inside author (which will be tricky for books with multiple authors), we embed the books ",(0,t.jsx)(n.code,{children:"_id"})," instead."]}),"\n",(0,t.jsxs)(n.p,{children:["So how can we get the author and all the books they have written embedded in the array? By using ",(0,t.jsx)(n.code,{children:"$lookup"}),"! That will do a left outer join and return author docs containing book docs inside."]}),"\n",(0,t.jsx)(n.p,{children:"\ud83d\udc50 Run this aggregation and look at the results:"}),"\n",(0,t.jsxs)(r.A,{groupId:"aggregations",children:[(0,t.jsx)(s.A,{value:"atlas",label:"Atlas UI",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'[\n  {$lookup: {\n      from: "books",\n      localField: "books",\n      foreignField: "_id",\n      as: "booksWritten"\n    } \n  },\n  {$project: {_id: 0}}\n]\n'})})}),(0,t.jsx)(s.A,{value:"mongodb-shell",label:"MongoDB Shell",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'db.authors.aggregate([\n  {$lookup: {\n      from: "books",\n      localField: "books",\n      foreignField: "_id",\n      as: "booksWritten"\n    } \n  },\n  {$project: {_id: 0}}\n])\n'})})})]}),"\n",(0,t.jsxs)(n.p,{children:["The syntax for this version of ",(0,t.jsx)(n.code,{children:"$lookup"})," is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'{\n   $lookup:\n     {\n       from: <collection to join>,\n       localField: <field from the input documents>,\n       foreignField: <field from the documents of the "from" collection>,\n       as: <output array field>\n     }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"lookups-from-a-previous-stage",children:"Lookups from a previous stage"}),"\n",(0,t.jsxs)(n.p,{children:["We can do a $lookup on the result of another pipeline, not only joining with a collection. For instance, we want to remove some noise from the books before joining, so we use ",(0,t.jsx)(n.code,{children:"$project"})," to exclude a couple of arrays."]}),"\n",(0,t.jsxs)(r.A,{groupId:"aggregations",children:[(0,t.jsx)(s.A,{value:"atlas",label:"Atlas UI",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'[\n  {$lookup: {\n      from: "books",\n      localField: "books",\n      foreignField: "_id",\n      pipeline: [\n        {$project: {title: 1, synopsis: 1}}\n      ],\n      as: "booksWritten"\n    } \n  }\n]\n'})})}),(0,t.jsx)(s.A,{value:"mongodb-shell",label:"MongoDB Shell",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'db.authors.aggregate([\n  {$lookup: {\n      from: "books",\n      localField: "books",\n      foreignField: "_id",\n      pipeline: [\n        {$project: {title: 1, synopsis: 1}}\n      ],\n      as: "booksWritten"\n    } \n  }\n])\n'})})})]}),"\n",(0,t.jsx)(n.p,{children:"The nice part is that we can extract that pipeline and test it/tweak it. (This will only work in the MongoDB Shell)"}),"\n",(0,t.jsx)(r.A,{groupId:"aggregations",children:(0,t.jsx)(s.A,{value:"mongodb-shell",label:"MongoDB Shell",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'let justShowTitleSynopsis = [\n  {$project: {title: 1, synopsis: 1}},\n]\n\ndb.authors.aggregate([\n  {$lookup: {\n      from: "books",\n      localField: "books",\n      foreignField: "_id",\n      pipeline:\n        justShowTitleSynopsis,\n      as: "booksWritten"\n    } \n  }\n])\n'})})})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},9365:(e,n,o)=>{o.d(n,{A:()=>s});o(6540);var t=o(8215);const a={tabItem:"tabItem_Ymn6"};var r=o(4848);function s(e){let{children:n,hidden:o,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,s),hidden:o,children:n})}},1470:(e,n,o)=>{o.d(n,{A:()=>y});var t=o(6540),a=o(8215),r=o(3104),s=o(6347),l=o(205),i=o(7485),u=o(1682),c=o(679);function d(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:o}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:o,attributes:t,default:a}}=e;return{value:n,label:o,attributes:t,default:a}}))}(o);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,o])}function p(e){let{value:n,tabValues:o}=e;return o.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:o}=e;const a=(0,s.W6)(),r=function(e){let{queryString:n=!1,groupId:o}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:n,groupId:o});return[(0,i.aZ)(r),(0,t.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})}),[r,a])]}function b(e){const{defaultValue:n,queryString:o=!1,groupId:a}=e,r=h(e),[s,i]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:o}=e;if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${o.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=o.find((e=>e.default))??o[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r}))),[u,d]=g({queryString:o,groupId:a}),[b,m]=function(e){let{groupId:n}=e;const o=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,r]=(0,c.Dv)(o);return[a,(0,t.useCallback)((e=>{o&&r.set(e)}),[o,r])]}({groupId:a}),f=(()=>{const e=u??b;return p({value:e,tabValues:r})?e:null})();(0,l.A)((()=>{f&&i(f)}),[f]);return{selectedValue:s,selectValue:(0,t.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);i(e),d(e),m(e)}),[d,m,r]),tabValues:r}}var m=o(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var k=o(4848);function v(e){let{className:n,block:o,selectedValue:t,selectValue:s,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:u}=(0,r.a_)(),c=e=>{const n=e.currentTarget,o=i.indexOf(n),a=l[o].value;a!==t&&(u(n),s(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const o=i.indexOf(e.currentTarget)+1;n=i[o]??i[0];break}case"ArrowLeft":{const o=i.indexOf(e.currentTarget)-1;n=i[o]??i[i.length-1];break}}n?.focus()};return(0,k.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":o},n),children:l.map((e=>{let{value:n,label:o,attributes:r}=e;return(0,k.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>i.push(e),onKeyDown:d,onClick:c,...r,className:(0,a.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":t===n}),children:o??n},n)}))})}function j(e){let{lazy:n,children:o,selectedValue:r}=e;const s=(Array.isArray(o)?o:[o]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,k.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function x(e){const n=b(e);return(0,k.jsxs)("div",{className:(0,a.A)("tabs-container",f.tabList),children:[(0,k.jsx)(v,{...n,...e}),(0,k.jsx)(j,{...n,...e})]})}function y(e){const n=(0,m.A)();return(0,k.jsx)(x,{...e,children:d(e.children)},String(n))}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var t=o(6540);const a={},r=t.createContext(a);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);